<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.sist.web.mapper.BoardMapper">
  <select id="boardListData" resultType="com.sist.web.vo.BoardVO" parameterType="hashmap"
  >
  	SELECT no,subject,name,TO_CHAR(regdate,'YYYY-MM-DD') as dbday,hit,group_tab,num
  	FROM (SELECT no,subject,name,regdate,hit,group_tab,rownum as num 
  	FROM (SELECT no,subject,name,regdate,hit,group_tab
  	FROM SpringReplyBoard ORDER BY group_id DESC, group_step ASC))
  	WHERE num BETWEEN #{start} AND #{end}
  </select>
  <select id="boardRowCount" resultType="int">
    SELECT COUNT(*) FROM SpringReplyBoard
  </select>  
  <insert id="boardInsert" parameterType="com.sist.web.vo.BoardVO">
    INSERT INTO SpringReplyBoard(no,name,subject,content,pwd,group_id)
    VALUES(srb_no_seq.nextval,#{name},#{subject},#{content},#{pwd},(SELECT NVL(MAX(group_id)+1,1) 
    FROM SpringReplyBoard))
  </insert>
  <!-- 							gi	gs	gt
  		AAAAAA					1	0	0	
  			=> BBBBBB			1	1	1
  				=> CCCCCC		1	2	2
  			=> DDDDDD			1	3	1
  		KKKKKK					2	0	0
   -->
   <!-- 상세보기 -->
   <update id="boardHitIncrement" parameterType="int">
     UPDATE SpringReplyBoard SET
     hit=hit+1
     WHERE no=#{no}
   </update>
   <select id="boardDetailData" resultType="com.sist.web.vo.BoardVO" parameterType="int"
   >
     SELECT no,name,subject,content,hit,TO_CHAR(regdate,'YYYY-MM-DD HH24:MI:SS') as dbday
     FROM SpringReplyBoard
     WHERE no=#{no}
   </select>
   <!-- 답변 -->
   <!-- 1. 상위 게시물의 정보 : group관련 -->
   <select id="boardParentInfoData" resultType="com.sist.web.vo.BoardVO"
   parameterType="int"
   >
     SELECT group_id,group_step,group_tab
     FROM SpringReplyBoard
     WHERE no=#{no}
   </select>
   <update id="boardGroupStepIncrement" parameterType="com.sist.web.vo.BoardVO">
     UPDATE SpringReplyBoard SET 
     group_step=group_step+1
     WHERE group_id=#{group_id} AND group_step>#{group_step}
   </update>
   <!-- 데이터 추가 -->
   <insert id="boardReplyInsert" parameterType="com.sist.web.vo.BoardVO">
    INSERT INTO SpringReplyBoard(no,name,subject,content,pwd,group_id,group_step,group_tab,root)
    VALUES(srb_no_seq.nextval,#{name},#{subject},#{content},#{pwd},#{group_id},#{group_step},#{group_tab},#{root})
  </insert>
  <update id="boardDepthIncrement" parameterType="int">
    UPDATE SpringReplyBoard SET
    depth=depth+1
    WHERE no=#{no}
  </update>
   <!-- 수정 : Vue 연동 -->
   <select id="boardGetPassword" resultType="string" parameterType="int"
   >
     SELECT pwd FROM SpringReplyBoard
     WHERE no=#{no}
   </select>
   <update id="boardUpdate" parameterType="com.sist.web.vo.BoardVO">
     UPDATE SpringReplyBoard SET
     name=#{name}, subject=#{subject}, content=#{content}
     WHERE no=#{no}
   </update>
   <!-- 삭제 : Vue 연동 -->
   <select id="boardDeleteInfoData" resultType="com.sist.web.vo.BoardVO" parameterType="int"
   >
     SELECT depth,root FROM SpringReplyBoard
     WHERE no=#{no}
   </select>
   <update id="boardSubjectChange" parameterType="int">
     UPDATE SpringReplyBoard SET
     subject='관리자에 의해 삭제된 게시물입니다',
     content='관리자에 의해 삭제된 게시물입니다'
     WHERE no=#{no}
   </update>
   <delete id="boardDelete" parameterType="int">
     DELETE FROM SpringReplyBoard
     WHERE no=#{no}
   </delete>
   <update id="boardDepthDecrement" parameterType="int">
     UPDATE SpringReplyBoard SET
     depth=depth-1
     WHERE no=#{no}
   </update>
 </mapper>